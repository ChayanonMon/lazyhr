<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- User Management Statistics Cards -->
<div th:fragment="userStatsCards(totalUsers, adminCount, managerCount, employeeCount)" class="row mb-4">
    <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <h3 th:text="${totalUsers ?: 0}">25</h3>
            <p class="mb-0">Total Users</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <h3 th:text="${adminCount ?: 0}">3</h3>
            <p class="mb-0">Administrators</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <h3 th:text="${managerCount ?: 0}">5</h3>
            <p class="mb-0">Managers</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <h3 th:text="${employeeCount ?: 0}">17</h3>
            <p class="mb-0">Employees</p>
        </div>
    </div>
</div>

<!-- User Table Component -->
<div th:fragment="usersTable(users)" class="card">
    <div class="card-header bg-light">
        <h5 class="mb-0">
            <i class="fas fa-users me-2"></i>User List
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="usersTable" class="table table-hover" th:if="${users != null && !users.isEmpty()}">
                <thead class="table-dark">
                    <tr>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Employee ID</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Position</th>
                        <th>Role</th>
                        <th>Join Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user : ${users}">
                        <td>
                            <div class="user-avatar" 
                                 th:text="${user.firstName != null and user.lastName != null ? 
                                          (user.firstName.substring(0,1) + user.lastName.substring(0,1)) : '??'}">
                                JD
                            </div>
                        </td>
                        <td th:text="${user.firstName + ' ' + user.lastName}">John Doe</td>
                        <td th:text="${user.employeeId}">EMP001</td>
                        <td th:text="${user.email}">john.doe@company.com</td>
                        <td th:text="${user.department ?: 'N/A'}">IT</td>
                        <td th:text="${user.position ?: 'N/A'}">Developer</td>
                        <td>
                            <span th:class="'role-badge ' + ${user.role.name().toLowerCase()}" 
                                  th:text="${user.role.name()}">EMPLOYEE</span>
                        </td>
                        <td th:text="${user.joinDate}">2024-01-15</td>
                        <td>
                            <span th:class="'user-status ' + (${user.active} ? 'status-active' : 'status-inactive')" 
                                  th:text="${user.active ? 'Active' : 'Inactive'}">Active</span>
                        </td>
                        <td>
                            <button class="action-btn view" 
                                    th:onclick="'viewUser(' + ${user.id} + ')'"
                                    title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" 
                                    th:onclick="'editUser(' + ${user.id} + ')'"
                                    title="Edit User">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn toggle" 
                                    th:onclick="'toggleUserStatus(' + ${user.id} + ')'"
                                    th:title="${user.active ? 'Deactivate' : 'Activate'}">
                                <i th:class="${user.active ? 'fas fa-user-slash' : 'fas fa-user-check'}"></i>
                            </button>
                            <button class="action-btn reset" 
                                    th:onclick="'resetPassword(' + ${user.id} + ')'"
                                    title="Reset Password">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="action-btn delete" 
                                    th:onclick="'deleteUser(' + ${user.id} + ')'"
                                    title="Delete User">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div th:unless="${users != null && !users.isEmpty()}" 
                 th:replace="~{fragments/common :: emptyState('users', 'No users found', 'Add users to get started')}">
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal Component -->
<div th:fragment="addUserModal" class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div th:replace="~{fragments/common :: modalHeader('Add New User', true)}"></div>
            <form id="addUserForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('firstName', 'First Name', 'text', 'Enter first name', true, 'user')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('lastName', 'Last Name', 'text', 'Enter last name', true, 'user')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('email', 'Email', 'email', 'Enter email address', true, 'envelope')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('employeeId', 'Employee ID', 'text', 'Enter employee ID', true, 'id-card')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('department', 'Department', 'text', 'Enter department', false, 'building')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('position', 'Position', 'text', 'Enter position', false, 'briefcase')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: selectGroup('role', 'Role', 
                                ${[{value: 'EMPLOYEE', text: 'Employee'}, 
                                   {value: 'MANAGER', text: 'Manager'}, 
                                   {value: 'ADMIN', text: 'Administrator'}]}, 
                                true, 'user-tag')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('joinDate', 'Join Date', 'date', null, true, 'calendar')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('username', 'Username', 'text', 'Enter username', true, 'user-circle')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('password', 'Password', 'password', 'Enter password', true, 'lock')}"></div>
                        </div>
                    </div>
                </div>
                <div th:replace="~{fragments/common :: modalFooter('Cancel', 'Add User', 'primary')}"></div>
            </form>
        </div>
    </div>
</div>

<!-- View User Modal Component -->
<div th:fragment="viewUserModal" class="modal fade" id="viewUserModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div th:replace="~{fragments/common :: modalHeader('User Details', true)}"></div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <div class="user-avatar large mb-3" id="viewUserAvatar">JD</div>
                        <h5 id="viewUserName">John Doe</h5>
                        <span class="role-badge employee" id="viewUserRole">EMPLOYEE</span>
                    </div>
                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong>Employee ID:</strong>
                                <div id="viewEmployeeId">EMP001</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Email:</strong>
                                <div id="viewEmail">john.doe@company.com</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Department:</strong>
                                <div id="viewDepartment">IT</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Position:</strong>
                                <div id="viewPosition">Developer</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Join Date:</strong>
                                <div id="viewJoinDate">2024-01-15</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Status:</strong>
                                <div id="viewStatus">Active</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="openEditUserModal()">
                    <i class="fas fa-edit me-1"></i>Edit User
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit User Modal Component -->
<div th:fragment="editUserModal" class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div th:replace="~{fragments/common :: modalHeader('Edit User', true)}"></div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId" name="userId" />
                <div class="modal-body">
                    <!-- Same form fields as add user modal but with edit prefixes -->
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editFirstName', 'First Name', 'text', 'Enter first name', true, 'user')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editLastName', 'Last Name', 'text', 'Enter last name', true, 'user')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editEmail', 'Email', 'email', 'Enter email address', true, 'envelope')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editEmployeeId', 'Employee ID', 'text', 'Enter employee ID', true, 'id-card')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editDepartment', 'Department', 'text', 'Enter department', false, 'building')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editPosition', 'Position', 'text', 'Enter position', false, 'briefcase')}"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: selectGroup('editRole', 'Role', 
                                ${[{value: 'EMPLOYEE', text: 'Employee'}, 
                                   {value: 'MANAGER', text: 'Manager'}, 
                                   {value: 'ADMIN', text: 'Administrator'}]}, 
                                true, 'user-tag')}"></div>
                        </div>
                        <div class="col-md-6">
                            <div th:replace="~{fragments/common :: inputGroup('editJoinDate', 'Join Date', 'date', null, true, 'calendar')}"></div>
                        </div>
                    </div>
                </div>
                <div th:replace="~{fragments/common :: modalFooter('Cancel', 'Update User', 'primary')}"></div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal Component -->
<div th:fragment="deleteUserModal" class="modal fade" id="deleteUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-user-times fa-4x text-danger mb-3"></i>
                    <h5>Are you sure you want to delete this user?</h5>
                    <p class="text-muted">This action cannot be undone. The user will be permanently removed from the system.</p>
                    <div class="alert alert-warning">
                        <strong>User:</strong> <span id="deleteUserName">John Doe</span><br>
                        <strong>Employee ID:</strong> <span id="deleteEmployeeId">EMP001</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteUser()">
                    <i class="fas fa-trash me-1"></i>Delete User
                </button>
            </div>
        </div>
    </div>
</div>

</body>
</html>

<!DOCTYPE html><html><head>
      <title>USAGE</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/map-pc-058/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.8.18/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="how-to-use-lazyhr-api-with-android-kotlin">How to Use LazyHR API with Android (Kotlin) </h1>
<p>This guide provides instructions and examples on how to interact with the LazyHR API from an Android application using Kotlin.</p>
<hr>
<h1 id="english">(English) </h1>
<h2 id="1-setup-dependencies">1. Setup Dependencies </h2>
<p>First, you need to add the following dependencies to your <code>build.gradle.kts</code> (or <code>build.gradle</code>) file to handle network requests and JSON parsing. We recommend using <strong>Retrofit</strong> for network calls and <strong>Gson</strong> for JSON serialization/deserialization.</p>
<p><strong>Why these dependencies?</strong></p>
<ul>
<li><strong>Retrofit</strong>: A type-safe HTTP client for Android and Java. It makes it easy to consume JSON or XML data which is then parsed into Plain Old Java Objects (POJOs).</li>
<li><strong>Gson</strong>: A Java library that can be used to convert Java Objects into their JSON representation. It can also be used to convert a JSON string to an equivalent Java object.</li>
<li><strong>OkHttp Logging Interceptor</strong>: Logs HTTP request and response data. This is very useful for debugging network issues.</li>
<li><strong>Kotlin Coroutines</strong>: For asynchronous programming. Network requests can't run on the main thread, so coroutines help manage background tasks efficiently.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// In your app's build.gradle.kts</span>

dependencies <span class="token punctuation">{</span>
    <span class="token comment">// Retrofit for network requests. This is the core library.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:retrofit:2.9.0"</span></span><span class="token punctuation">)</span>
    <span class="token comment">// This is the converter for Gson, which serializes and deserializes JSON.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:converter-gson:2.9.0"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// OkHttp for logging. This is optional but highly recommended for debugging.</span>
    <span class="token comment">// It allows you to see the raw request and response in your Logcat.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.okhttp3:logging-interceptor:4.9.3"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// Kotlin Coroutines for managing background threads for network calls.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.1"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="2-create-retrofit-instance">2. Create Retrofit Instance </h2>
<p>Create a singleton object to manage your Retrofit instance. This ensures that you only have one instance of Retrofit throughout your app, which is efficient. Replace <code>your-server-ip</code> with the actual IP address or domain of your server.</p>
<p><strong>Why a Singleton?</strong></p>
<ul>
<li>A Singleton pattern ensures that a class has only one instance and provides a global point of access to it. For network clients, this is efficient as it reuses the same configuration and connection pool.</li>
</ul>
<p><strong>Why <code>by lazy</code>?</strong></p>
<ul>
<li><code>by lazy</code> is a property delegate that creates the instance of Retrofit only when it's accessed for the first time, making the app startup faster.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>OkHttpClient
<span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>HttpLoggingInterceptor
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>Retrofit
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>converter<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>GsonConverterFactory

<span class="token comment">// A singleton object to hold our Retrofit instance.</span>
<span class="token keyword keyword-object">object</span> ApiClient <span class="token punctuation">{</span>

    <span class="token comment">// IMPORTANT: Replace with your server's IP address or domain.</span>
    <span class="token comment">// This is the base URL for all your API calls.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> BASE_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"http://your-server-ip:8080/lazyhr/"</span></span>

    <span class="token comment">// Create a logging interceptor to see request/response details in Logcat.</span>
    <span class="token comment">// This is a huge help for debugging network problems.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> loggingInterceptor <span class="token operator">=</span> <span class="token function">HttpLoggingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        level <span class="token operator">=</span> HttpLoggingInterceptor<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>BODY <span class="token comment">// Log the entire request and response body.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create an OkHttpClient and add the logging interceptor.</span>
    <span class="token comment">// OkHttp is the underlying HTTP client for Retrofit.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> okHttpClient <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>loggingInterceptor<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Create the Retrofit instance using the 'lazy' delegate.</span>
    <span class="token comment">// This means the instance is created only when it's first needed.</span>
    <span class="token keyword keyword-val">val</span> instance<span class="token operator">:</span> Retrofit <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span>
        Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>BASE_URL<span class="token punctuation">)</span> <span class="token comment">// Set the base URL for all requests.</span>
            <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>okHttpClient<span class="token punctuation">)</span> <span class="token comment">// Use our custom OkHttpClient with the logger.</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Use Gson to handle JSON.</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="3-define-api-interface">3. Define API Interface </h2>
<p>Create an interface that defines all the API endpoints you need to access. Retrofit will automatically generate the implementation for this interface. All functions should be marked with <code>suspend</code> to be used with coroutines.</p>
<p><strong>Why an Interface?</strong></p>
<ul>
<li>Retrofit uses annotations on an interface to define how requests are made. This approach is clean, declarative, and separates the API definition from the implementation.</li>
</ul>
<p><strong>Why <code>suspend</code>?</strong></p>
<ul>
<li>The <code>suspend</code> keyword marks the function as a coroutine function. This allows it to be paused and resumed, which is perfect for long-running operations like network calls, without blocking the main thread.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Body
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>GET
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>POST
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Path
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Query

<span class="token keyword keyword-interface">interface</span> ApiService <span class="token punctuation">{</span>

    <span class="token comment">// --- User Management ---</span>
    <span class="token comment">// @GET defines an HTTP GET request. The string is the path relative to the base URL.</span>
    <span class="token comment">// @Path replaces {userId} in the URL with the value of the userId parameter.</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/users/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span>

    <span class="token comment">// --- Attendance Management ---</span>
    <span class="token comment">// @POST defines an HTTP POST request.</span>
    <span class="token comment">// @Query adds a query parameter to the URL (e.g., /clock-in?userId=1).</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-in"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-out"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/today/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getTodayAttendance</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Attendance<span class="token operator">?</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserAttendance</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"startTimestamp"</span></span><span class="token punctuation">)</span> startTimestamp<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"endTimestamp"</span></span><span class="token punctuation">)</span> endTimestamp<span class="token operator">:</span> Long
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/history/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token comment">// --- Leave Management ---</span>
    <span class="token comment">// @Body tells Retrofit to serialize the leaveRequest object into the request body as JSON.</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/apply"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserLeaves</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/{leaveId}/approve"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">approveLeave</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"leaveId"</span></span><span class="token punctuation">)</span> leaveId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"approverId"</span></span><span class="token punctuation">)</span> approverId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"comments"</span></span><span class="token punctuation">)</span> comments<span class="token operator">:</span> String<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="4-create-data-classes-dtos">4. Create Data Classes (DTOs) </h2>
<p>Define Kotlin data classes that match the JSON structure of your API responses and request bodies. All timestamp fields should be of type <code>Long</code>.</p>
<p><strong>Why <code>data class</code>?</strong></p>
<ul>
<li><code>data class</code> is a concise way to create classes that just hold data. The compiler automatically generates useful methods like <code>toString()</code>, <code>equals()</code>, <code>hashCode()</code>, and <code>copy()</code>.</li>
</ul>
<p><strong>Why match the JSON structure?</strong></p>
<ul>
<li>Gson uses reflection to map the fields in the JSON to the properties in your data class. The names must match for this to work automatically.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// A data class to hold User information. The property names match the JSON keys.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">User</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> firstName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> lastName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> employeeId<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> department<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> position<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> hireDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> salary<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> role<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ADMIN", "MANAGER", "EMPLOYEE"</span>
    <span class="token keyword keyword-val">val</span> isActive<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A data class for an Attendance record.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">Attendance</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> attendanceDate<span class="token operator">:</span> Long<span class="token punctuation">,</span> <span class="token comment">// Timestamp for the start of the day</span>
    <span class="token keyword keyword-val">val</span> clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>   <span class="token comment">// Exact clock-in timestamp</span>
    <span class="token keyword keyword-val">val</span> clockOutTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>  <span class="token comment">// Exact clock-out timestamp</span>
    <span class="token keyword keyword-val">val</span> totalHours<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> overtimeHours<span class="token operator">:</span> Double<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PRESENT", "ABSENT", "LATE", "HALF_DAY"</span>
    <span class="token keyword keyword-val">val</span> notes<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> breakDurationMinutes<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A Data Transfer Object (DTO) for creating a leave request.</span>
<span class="token comment">// It's good practice to use DTOs for request bodies to control what data is sent.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ANNUAL", "PRIVATE", "SICK", "SPECIAL_HOLIDAY"</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>   <span class="token comment">// "AM", "PM", "FULL_DAY"</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>       <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>         <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String
<span class="token punctuation">)</span>

<span class="token comment">// A data class for the response of a leave request.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequest</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PENDING", "APPROVED", "REJECTED"</span>
    <span class="token keyword keyword-val">val</span> appliedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> approvedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> comments<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> totalDays<span class="token operator">:</span> Double<span class="token operator">?</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A generic wrapper for all API responses. This standardizes how you handle responses.</span>
<span class="token comment">// The 'data' property is generic, so it can hold any type of data (a User, a List of Attendances, etc.).</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> ApiResponse<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "success" or "error"</span>
    <span class="token keyword keyword-val">val</span> message<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span><span class="token operator">:</span> T<span class="token operator">?</span>
<span class="token punctuation">)</span>
</code></pre><h2 id="5-making-api-calls-mvc-pattern">5. Making API Calls (MVC Pattern) </h2>
<p>Here's how to implement the MVC pattern for making API calls. We'll create separate Model, Controller, and View components. This separation of concerns makes the code more organized, easier to test, and maintain.</p>
<h3 id="model-layer-data-repository">Model Layer (Data Repository) </h3>
<p>The Repository's job is to provide data to the rest of the app. It abstracts the data source (in this case, the network API).</p>
<p><strong>Why <code>withContext(Dispatchers.IO)</code>?</strong></p>
<ul>
<li>This function switches the coroutine to the IO dispatcher, which is optimized for I/O operations like network requests. This is crucial for keeping the UI thread free and responsive.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// The repository class is responsible for all data operations.</span>
<span class="token keyword keyword-class">class</span> HrRepository <span class="token punctuation">{</span>
    
    <span class="token comment">// Create an instance of our ApiService.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> apiService <span class="token operator">=</span> ApiClient<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApiService<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    
    <span class="token comment">// Each function in the repository calls a corresponding function in the ApiService.</span>
    <span class="token comment">// We use withContext(Dispatchers.IO) to ensure the network call happens on a background thread.</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="controller-layer">Controller Layer </h3>
<p>The Controller acts as a bridge between the View (UI) and the Model (Repository). It handles user actions, fetches data from the repository, and tells the View what to display.</p>
<p><strong>Why <code>CoroutineScope(Dispatchers.Main)</code>?</strong></p>
<ul>
<li>We create a coroutine scope tied to the main thread. This is important because UI updates must happen on the main thread.</li>
</ul>
<p><strong>Why <code>try-catch-finally</code>?</strong></p>
<ul>
<li>This is a standard way to handle potential errors (like network failures) and ensure that cleanup code (like hiding a loading indicator) always runs.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>CoroutineScope
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// The controller takes a reference to the View interface.</span>
<span class="token keyword keyword-class">class</span> <span class="token function">HrController</span><span class="token punctuation">(</span><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> HrView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> repository <span class="token operator">=</span> <span class="token function">HrRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Create a coroutine scope for launching coroutines from the controller.</span>
    <span class="token comment">// We use Dispatchers.Main because the controller will be updating the UI.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> controllerScope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">clockInUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Launch a new coroutine without blocking the current thread.</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// Show a loading indicator on the UI.</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Get data from the repository (this happens on a background thread).</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token comment">// Switch back to the main thread to update the UI.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span>
                        <span class="token keyword keyword-val">val</span> clockInTime <span class="token operator">=</span> <span class="token keyword keyword-data">data</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"clockInTime"</span></span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Long
                        view<span class="token punctuation">.</span><span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token punctuation">)</span> <span class="token comment">// Update the UI with the result.</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Clock-in failed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// Show an error message.</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Handle exceptions, like network errors.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// This block always executes, whether there was an error or not.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// Hide the loading indicator.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> reason<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Example of creating a request object.</span>
                <span class="token keyword keyword-val">val</span> startTimestamp <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-val">val</span> endTimestamp <span class="token operator">=</span> startTimestamp <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 2 days later</span>
                
                <span class="token keyword keyword-val">val</span> leaveDto <span class="token operator">=</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
                    userId <span class="token operator">=</span> userId<span class="token punctuation">,</span>
                    leaveCategory <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"ANNUAL"</span></span><span class="token punctuation">,</span>
                    leavePeriod <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"FULL_DAY"</span></span><span class="token punctuation">,</span>
                    startDate <span class="token operator">=</span> startTimestamp<span class="token punctuation">,</span>
                    endDate <span class="token operator">=</span> endTimestamp<span class="token punctuation">,</span>
                    reason <span class="token operator">=</span> reason
                <span class="token punctuation">)</span>
                
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveDto<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Leave application failed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">loadUserData</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">displayUserData</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Failed to load user data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="view-interface">View Interface </h3>
<p>This interface defines a contract for what the View must be able to do. This decouples the Controller from the specific implementation of the View (e.g., an Activity or a Fragment).</p>
<p><strong>Why an Interface?</strong></p>
<ul>
<li>It makes the Controller more testable. You can create a "mock" view for testing without needing a real Android UI.</li>
<li>It improves code organization and follows the principles of clean architecture.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// This interface defines the contract between the Controller and the View.</span>
<span class="token comment">// The Activity or Fragment will implement this interface.</span>
<span class="token keyword keyword-interface">interface</span> HrView <span class="token punctuation">{</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">showLoading</span><span class="token punctuation">(</span>isLoading<span class="token operator">:</span> Boolean<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequest<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">displayUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="activityfragment-implementation-view-layer">Activity/Fragment Implementation (View Layer) </h3>
<p>The Activity or Fragment is the actual UI. It implements the <code>HrView</code> interface and delegates all logic to the <code>HrController</code>.</p>
<p><strong>Why delegate to the Controller?</strong></p>
<ul>
<li>This keeps the Activity/Fragment clean and focused on its primary job: managing the UI. It shouldn't contain business logic or data fetching code.</li>
</ul>
<h1 id="how-to-use-lazyhr-api-with-android-kotlin-1">How to Use LazyHR API with Android (Kotlin) </h1>
<p>This guide provides instructions and examples on how to interact with the LazyHR API from an Android application using Kotlin.</p>
<hr>
<h1 id="english-1">(English) </h1>
<h2 id="1-setup-dependencies-1">1. Setup Dependencies </h2>
<p>First, you need to add the following dependencies to your <code>build.gradle.kts</code> (or <code>build.gradle</code>) file to handle network requests and JSON parsing. We recommend using <strong>Retrofit</strong> for network calls and <strong>Gson</strong> for JSON serialization/deserialization.</p>
<p><strong>Why these dependencies?</strong></p>
<ul>
<li><strong>Retrofit</strong>: Think of this as your friendly neighborhood mail carrier for the internet. It's a fantastic library that makes it super simple to fetch data from a server. You tell it what you want, and it brings it back to you, neatly packaged.</li>
<li><strong>Gson</strong>: This is Retrofit's trusty translator. The data you get from the server is usually in a language called JSON. Gson takes that JSON and turns it into Kotlin objects you can actually work with in your code.</li>
<li><strong>OkHttp Logging Interceptor</strong>: This is like having x-ray vision for your network requests. It prints out the details of every request you send and every response you get. It's a lifesaver when you're trying to figure out why something isn't working!</li>
<li><strong>Kotlin Coroutines</strong>: These are your secret weapon for keeping your app's UI smooth and responsive. Network requests can take a moment, and you don't want your app to freeze while it's waiting. Coroutines let you run these tasks in the background without any fuss.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// In your app's build.gradle.kts</span>

dependencies <span class="token punctuation">{</span>
    <span class="token comment">// Retrofit for network requests. This is the core library.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:retrofit:2.9.0"</span></span><span class="token punctuation">)</span>
    <span class="token comment">// This is the converter for Gson, which serializes and deserializes JSON.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:converter-gson:2.9.0"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// OkHttp for logging. This is optional but highly recommended for debugging.</span>
    <span class="token comment">// It allows you to see the raw request and response in your Logcat.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.okhttp3:logging-interceptor:4.9.3"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// Kotlin Coroutines for managing background threads for network calls.</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.1"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="2-create-retrofit-instance-1">2. Create Retrofit Instance </h2>
<p>Create a singleton object to manage your Retrofit instance. This ensures that you only have one instance of Retrofit throughout your app, which is efficient. Replace <code>your-server-ip</code> with the actual IP address or domain of your server.</p>
<p><strong>Why a Singleton?</strong></p>
<ul>
<li>Think of it like having one main post office for your whole town. Instead of building a new one every time you want to send a letter, you just use the one that's already there. It's much more efficient! A singleton ensures you have just one <code>ApiClient</code> for your whole app.</li>
</ul>
<p><strong>Why <code>by lazy</code>?</strong></p>
<ul>
<li>This is a clever bit of Kotlin magic. It means "don't create this Retrofit instance until the very first time I actually need it." This helps your app start up a little bit faster.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>OkHttpClient
<span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>HttpLoggingInterceptor
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>Retrofit
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>converter<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>GsonConverterFactory

<span class="token comment">// A singleton object to hold our Retrofit instance.</span>
<span class="token keyword keyword-object">object</span> ApiClient <span class="token punctuation">{</span>

    <span class="token comment">// IMPORTANT: Replace with your server's IP address or domain.</span>
    <span class="token comment">// This is the base URL for all your API calls.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> BASE_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"http://your-server-ip:8080/lazyhr/"</span></span>

    <span class="token comment">// Create a logging interceptor to see request/response details in Logcat.</span>
    <span class="token comment">// This is a huge help for debugging network problems.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> loggingInterceptor <span class="token operator">=</span> <span class="token function">HttpLoggingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        level <span class="token operator">=</span> HttpLoggingInterceptor<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>BODY <span class="token comment">// Log the entire request and response body.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create an OkHttpClient and add the logging interceptor.</span>
    <span class="token comment">// OkHttp is the underlying HTTP client for Retrofit.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> okHttpClient <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>loggingInterceptor<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Create the Retrofit instance using the 'lazy' delegate.</span>
    <span class="token comment">// This means the instance is created only when it's first needed.</span>
    <span class="token keyword keyword-val">val</span> instance<span class="token operator">:</span> Retrofit <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span>
        Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>BASE_URL<span class="token punctuation">)</span> <span class="token comment">// Set the base URL for all requests.</span>
            <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>okHttpClient<span class="token punctuation">)</span> <span class="token comment">// Use our custom OkHttpClient with the logger.</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Use Gson to handle JSON.</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="3-define-api-interface-1">3. Define API Interface </h2>
<p>Create an interface that defines all the API endpoints you need to access. Retrofit will automatically generate the implementation for this interface. All functions should be marked with <code>suspend</code> to be used with coroutines.</p>
<p><strong>Why an Interface?</strong></p>
<ul>
<li>This is like creating a menu for a restaurant. You list all the dishes (API calls) you can order, but you don't have to worry about how they're cooked in the kitchen. Retrofit takes care of all the "cooking" for you. It's a very clean way to define your API.</li>
</ul>
<p><strong>Why <code>suspend</code>?</strong></p>
<ul>
<li>This little keyword is a big deal. It tells Kotlin that this function might take a while (like a network call) and that it's okay to "pause" it and come back later, without freezing the app. It's the heart of how coroutines work.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Body
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>GET
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>POST
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Path
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Query

<span class="token keyword keyword-interface">interface</span> ApiService <span class="token punctuation">{</span>

    <span class="token comment">// --- User Management ---</span>
    <span class="token comment">// @GET defines an HTTP GET request. The string is the path relative to the base URL.</span>
    <span class="token comment">// @Path replaces {userId} in the URL with the value of the userId parameter.</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/users/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span>

    <span class="token comment">// --- Attendance Management ---</span>
    <span class="token comment">// @POST defines an HTTP POST request.</span>
    <span class="token comment">// @Query adds a query parameter to the URL (e.g., /clock-in?userId=1).</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-in"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-out"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/today/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getTodayAttendance</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Attendance<span class="token operator">?</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserAttendance</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"startTimestamp"</span></span><span class="token punctuation">)</span> startTimestamp<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"endTimestamp"</span></span><span class="token punctuation">)</span> endTimestamp<span class="token operator">:</span> Long
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/history/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token comment">// --- Leave Management ---</span>
    <span class="token comment">// @Body tells Retrofit to serialize the leaveRequest object into the request body as JSON.</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/apply"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserLeaves</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/{leaveId}/approve"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">approveLeave</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"leaveId"</span></span><span class="token punctuation">)</span> leaveId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"approverId"</span></span><span class="token punctuation">)</span> approverId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"comments"</span></span><span class="token punctuation">)</span> comments<span class="token operator">:</span> String<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="4-create-data-classes-dtos-1">4. Create Data Classes (DTOs) </h2>
<p>Define Kotlin data classes that match the JSON structure of your API responses and request bodies. All timestamp fields should be of type <code>Long</code>.</p>
<p><strong>Why <code>data class</code>?</strong></p>
<ul>
<li><code>data class</code> is a Kotlin superpower. You just declare the data you need, and Kotlin writes all the boring boilerplate code for you (like <code>toString()</code>, <code>equals()</code>, etc.). It's clean and saves you a ton of typing.</li>
</ul>
<p><strong>Why match the JSON structure?</strong></p>
<ul>
<li>This is how you make Gson's job easy. If the names of your properties in the data class match the names of the keys in the JSON, Gson can automatically convert between the two without any extra code. It's like magic!</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// A data class to hold User information. The property names match the JSON keys.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">User</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> firstName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> lastName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> employeeId<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> department<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> position<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> hireDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> salary<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> role<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ADMIN", "MANAGER", "EMPLOYEE"</span>
    <span class="token keyword keyword-val">val</span> isActive<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A data class for an Attendance record.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">Attendance</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> attendanceDate<span class="token operator">:</span> Long<span class="token punctuation">,</span> <span class="token comment">// Timestamp for the start of the day</span>
    <span class="token keyword keyword-val">val</span> clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>   <span class="token comment">// Exact clock-in timestamp</span>
    <span class="token keyword keyword-val">val</span> clockOutTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>  <span class="token comment">// Exact clock-out timestamp</span>
    <span class="token keyword keyword-val">val</span> totalHours<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> overtimeHours<span class="token operator">:</span> Double<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PRESENT", "ABSENT", "LATE", "HALF_DAY"</span>
    <span class="token keyword keyword-val">val</span> notes<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> breakDurationMinutes<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A Data Transfer Object (DTO) for creating a leave request.</span>
<span class="token comment">// It's good practice to use DTOs for request bodies to control what data is sent.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ANNUAL", "PRIVATE", "SICK", "SPECIAL_HOLIDAY"</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>   <span class="token comment">// "AM", "PM", "FULL_DAY"</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>       <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>         <span class="token comment">// Unix timestamp in milliseconds</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String
<span class="token punctuation">)</span>

<span class="token comment">// A data class for the response of a leave request.</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequest</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PENDING", "APPROVED", "REJECTED"</span>
    <span class="token keyword keyword-val">val</span> appliedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> approvedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> comments<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> totalDays<span class="token operator">:</span> Double<span class="token operator">?</span>
    <span class="token comment">// ... other fields</span>
<span class="token punctuation">)</span>

<span class="token comment">// A generic wrapper for all API responses. This standardizes how you handle responses.</span>
<span class="token comment">// The 'data' property is generic, so it can hold any type of data (a User, a List of Attendances, etc.).</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> ApiResponse<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "success" or "error"</span>
    <span class="token keyword keyword-val">val</span> message<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span><span class="token operator">:</span> T<span class="token operator">?</span>
<span class="token punctuation">)</span>
</code></pre><h2 id="5-making-api-calls-mvc-pattern-1">5. Making API Calls (MVC Pattern) </h2>
<p>Here's how to implement the MVC pattern for making API calls. We'll create separate Model, Controller, and View components. This separation of concerns makes the code more organized, easier to test, and maintain.</p>
<h3 id="model-layer-data-repository-1">Model Layer (Data Repository) </h3>
<p>The Repository's job is to be the single source of truth for your app's data. It doesn't care where the data comes from (network, database, etc.), it just provides it to whoever asks.</p>
<p><strong>Why <code>withContext(Dispatchers.IO)</code>?</strong></p>
<ul>
<li>This is a key part of coroutines. It tells Kotlin, "Hey, this next bit of code involves network or disk I/O, so please run it on a background thread that's optimized for that." This keeps your app's UI from stuttering.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// The repository class is responsible for all data operations.</span>
<span class="token keyword keyword-class">class</span> HrRepository <span class="token punctuation">{</span>
    
    <span class="token comment">// Create an instance of our ApiService.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> apiService <span class="token operator">=</span> ApiClient<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApiService<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    
    <span class="token comment">// Each function in the repository calls a corresponding function in the ApiService.</span>
    <span class="token comment">// We use withContext(Dispatchers.IO) to ensure the network call happens on a background thread.</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="controller-layer-1">Controller Layer </h3>
<p>The Controller is the "brains" of the operation. It responds to user input (like a button click), asks the Repository for data, and then tells the View what to show.</p>
<p><strong>Why <code>CoroutineScope(Dispatchers.Main)</code>?</strong></p>
<ul>
<li>We're creating a "scope" or a context for our coroutines that's tied to the main UI thread. This is important because you can only update the UI from the main thread.</li>
</ul>
<p><strong>Why <code>try-catch-finally</code>?</strong></p>
<ul>
<li>This is your safety net. The <code>try</code> block is where you do the risky stuff (like network calls). The <code>catch</code> block is where you handle things if they go wrong (like a network error). The <code>finally</code> block is code that <em>always</em> runs, no matter what, which is perfect for things like hiding a loading spinner.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>CoroutineScope
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// The controller takes a reference to the View interface.</span>
<span class="token keyword keyword-class">class</span> <span class="token function">HrController</span><span class="token punctuation">(</span><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> HrView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> repository <span class="token operator">=</span> <span class="token function">HrRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Create a coroutine scope for launching coroutines from the controller.</span>
    <span class="token comment">// We use Dispatchers.Main because the controller will be updating the UI.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> controllerScope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">clockInUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Launch a new coroutine without blocking the current thread.</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// Show a loading indicator on the UI.</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Get data from the repository (this happens on a background thread).</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token comment">// Switch back to the main thread to update the UI.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span>
                        <span class="token keyword keyword-val">val</span> clockInTime <span class="token operator">=</span> <span class="token keyword keyword-data">data</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"clockInTime"</span></span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Long
                        view<span class="token punctuation">.</span><span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token punctuation">)</span> <span class="token comment">// Update the UI with the result.</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Clock-in failed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// Show an error message.</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Handle exceptions, like network errors.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// This block always executes, whether there was an error or not.</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// Hide the loading indicator.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> reason<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Example of creating a request object.</span>
                <span class="token keyword keyword-val">val</span> startTimestamp <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-val">val</span> endTimestamp <span class="token operator">=</span> startTimestamp <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 2 days later</span>
                
                <span class="token keyword keyword-val">val</span> leaveDto <span class="token operator">=</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
                    userId <span class="token operator">=</span> userId<span class="token punctuation">,</span>
                    leaveCategory <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"ANNUAL"</span></span><span class="token punctuation">,</span>
                    leavePeriod <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"FULL_DAY"</span></span><span class="token punctuation">,</span>
                    startDate <span class="token operator">=</span> startTimestamp<span class="token punctuation">,</span>
                    endDate <span class="token operator">=</span> endTimestamp<span class="token punctuation">,</span>
                    reason <span class="token operator">=</span> reason
                <span class="token punctuation">)</span>
                
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveDto<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Leave application failed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">loadUserData</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">displayUserData</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Failed to load user data: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Network error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
            <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="view-interface-1">View Interface </h3>
<p>This interface is like a contract. It says, "Any screen that wants to be a 'HrView' <em>must</em> know how to do these things (like show a loading spinner or display an error)." This helps keep your code clean and makes it easy to test your Controller without needing a real screen.</p>
<p><strong>Why an Interface?</strong></p>
<ul>
<li>It's a core principle of good software design. It separates the "what" (the contract) from the "how" (the implementation). This makes your code more flexible and easier to change later.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// This interface defines the contract between the Controller and the View.</span>
<span class="token comment">// The Activity or Fragment will implement this interface.</span>
<span class="token keyword keyword-interface">interface</span> HrView <span class="token punctuation">{</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">showLoading</span><span class="token punctuation">(</span>isLoading<span class="token operator">:</span> Boolean<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequest<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">displayUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="activityfragment-implementation-view-layer-1">Activity/Fragment Implementation (View Layer) </h3>
<p>This is your actual screen. Its main job is to look pretty and tell the Controller when the user does something. It implements the <code>HrView</code> interface, promising to fulfill the contract we defined earlier.</p>
<p><strong>Why delegate to the Controller?</strong></p>
<ul>
<li>This keeps your Activity/Fragment code simple and focused on UI stuff. All the complex logic lives in the Controller, making your code much easier to read, debug, and test.</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ProgressBar
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Toast
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View

<span class="token comment">// The MainActivity implements the HrView interface.</span>
<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HrView <span class="token punctuation">{</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> controller<span class="token operator">:</span> HrController
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> loadingIndicator<span class="token operator">:</span> ProgressBar
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> clockInButton<span class="token operator">:</span> Button
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> applyLeaveButton<span class="token operator">:</span> Button
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> userInfoText<span class="token operator">:</span> TextView
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        
        <span class="token comment">// Create the controller, passing a reference to this activity (the view).</span>
        controller <span class="token operator">=</span> <span class="token function">HrController</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        <span class="token function">initViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">setupClickListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">initViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        loadingIndicator <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>loading_indicator<span class="token punctuation">)</span>
        clockInButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_clock_in<span class="token punctuation">)</span>
        applyLeaveButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_apply_leave<span class="token punctuation">)</span>
        userInfoText <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_user_info<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">setupClickListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// When a button is clicked, call the corresponding method in the controller.</span>
        clockInButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            controller<span class="token punctuation">.</span><span class="token function">clockInUser</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span> <span class="token comment">// Replace with actual user ID</span>
        <span class="token punctuation">}</span>
        
        applyLeaveButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            controller<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Annual vacation"</span></span><span class="token punctuation">)</span> <span class="token comment">// Replace with actual user ID and reason</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Load initial data when the activity starts.</span>
        controller<span class="token punctuation">.</span><span class="token function">loadUserData</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// --- HrView interface implementations ---</span>
    <span class="token comment">// These methods are called by the controller to update the UI.</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">showLoading</span><span class="token punctuation">(</span>isLoading<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        loadingIndicator<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> View<span class="token punctuation">.</span>VISIBLE <span class="token keyword keyword-else">else</span> View<span class="token punctuation">.</span>GONE
        clockInButton<span class="token punctuation">.</span>isEnabled <span class="token operator">=</span> <span class="token operator">!</span>isLoading
        applyLeaveButton<span class="token punctuation">.</span>isEnabled <span class="token operator">=</span> <span class="token operator">!</span>isLoading
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Successfully clocked in at: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">clockInTime</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequest<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Leave submitted successfully with ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">leaveRequest<span class="token operator">?</span><span class="token punctuation">.</span>id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">displayUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        user<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
            userInfoText<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Welcome, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>firstName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>lastName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nDepartment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>department</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<h1 id="ภาษาไทย">(ภาษาไทย) </h1>
<h2 id="1-ตั้งค่า-dependencies">1. ตั้งค่า Dependencies </h2>
<p>ก่อนอื่นเลย เราต้องเพิ่มเครื่องมือที่จำเป็นลงในโปรเจกต์ของเราก่อนในไฟล์ <code>build.gradle.kts</code> (หรือ <code>build.gradle</code>) เครื่องมือเหล่านี้จะช่วยเราคุยกับเซิร์ฟเวอร์และจัดการข้อมูลที่ได้กลับมา</p>
<p><strong>เครื่องมือเหล่านี้คืออะไร?</strong></p>
<ul>
<li><strong>Retrofit</strong>: คิดซะว่า Retrofit คือบุรุษไปรษณีย์ส่วนตัวของเราสำหรับแอป มันช่วยให้การส่งคำขอและรับข้อมูลจากเซิร์ฟเวอร์เป็นเรื่องง่ายและเป็นระเบียบ</li>
<li><strong>Gson</strong>: นี่คือล่ามคู่ใจของ Retrofit ข้อมูลที่ได้จากเซิร์ฟเวอร์มักจะมาในรูปแบบที่เรียกว่า JSON ซึ่ง Gson จะช่วยแปล JSON เหล่านี้ให้เป็น Kotlin object ที่เราเอาไปใช้งานต่อในโค้ดได้เลย</li>
<li><strong>OkHttp Logging Interceptor</strong>: เหมือนเรามีแว่นเอ็กซเรย์สำหรับดูการสื่อสารทางเน็ตเวิร์ก มันจะแสดงให้เราเห็นทุกอย่างที่เราส่งไปและรับกลับมา ซึ่งมีประโยชน์สุดๆ เวลาที่เราหาสาเหตุว่าทำไมแอปไม่ทำงาน</li>
<li><strong>Kotlin Coroutines</strong>: นี่คือสุดยอดอาวุธลับที่จะทำให้แอปของเราลื่นไหล ไม่ค้าง การคุยกับเซิร์ฟเวอร์อาจใช้เวลาสักครู่ Coroutines จะช่วยให้เราทำงานนี้เบื้องหลังได้แบบเนียนๆ โดยที่หน้าจอแอปไม่หยุดทำงาน</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// ในไฟล์ build.gradle.kts (Module :app)</span>

dependencies <span class="token punctuation">{</span>
    <span class="token comment">// Retrofit สำหรับการเชื่อมต่อเน็ตเวิร์ก (ไลบรารีหลัก)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:retrofit:2.9.0"</span></span><span class="token punctuation">)</span>
    <span class="token comment">// ตัวแปลงสำหรับ Gson ซึ่งทำหน้าที่แปลง JSON</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.retrofit2:converter-gson:2.9.0"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// OkHttp สำหรับการแสดง log (ตัวเลือกเสริม แต่แนะนำอย่างยิ่งเพื่อการดีบัก)</span>
    <span class="token comment">// ช่วยให้คุณเห็น request และ response ดิบๆ ใน Logcat</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.squareup.okhttp3:logging-interceptor:4.9.3"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// Kotlin Coroutines สำหรับจัดการ background threads สำหรับ network calls</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.1"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="2-สร้าง-retrofit-instance">2. สร้าง Retrofit Instance </h2>
<p>เราจะสร้าง <code>ApiClient</code> ให้เป็น object เดียว (Singleton) เพื่อจัดการ Retrofit instance ทั้งหมดในแอป การทำแบบนี้จะช่วยให้แอปทำงานได้มีประสิทธิภาพมากขึ้น และอย่าลืมเปลี่ยน <code>your-server-ip</code> เป็น IP ของเซิร์ฟเวอร์จริงๆ ด้วยนะ</p>
<p><strong>ทำไมต้องเป็น Singleton?</strong></p>
<ul>
<li>ลองนึกภาพว่าเรามีที่ทำการไปรษณีย์หลักแค่แห่งเดียวในเมือง แทนที่จะต้องสร้างใหม่ทุกครั้งที่อยากส่งจดหมาย เราก็แค่ไปใช้ที่เดิมที่มีอยู่แล้ว มันเร็วกว่าเยอะ! Singleton ก็เหมือนกัน คือการสร้าง <code>ApiClient</code> แค่ครั้งเดียวแล้วใช้ร่วมกันทั้งแอป</li>
</ul>
<p><strong>ทำไมต้อง <code>by lazy</code>?</strong></p>
<ul>
<li>นี่เป็นเทคนิคเจ๋งๆ ของ Kotlin ที่บอกว่า "ยังไม่ต้องสร้าง Retrofit นะ รอจนกว่าจะมีคนเรียกใช้ครั้งแรกจริงๆ ค่อยสร้าง" ซึ่งช่วยให้แอปของเราเปิดตัวได้เร็วขึ้นนิดหน่อย</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>OkHttpClient
<span class="token keyword keyword-import">import</span> okhttp3<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>HttpLoggingInterceptor
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>Retrofit
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>converter<span class="token punctuation">.</span>gson<span class="token punctuation">.</span>GsonConverterFactory

<span class="token comment">// Singleton object สำหรับเก็บ Retrofit instance ของเรา</span>
<span class="token keyword keyword-object">object</span> ApiClient <span class="token punctuation">{</span>

    <span class="token comment">//สำคัญ: เปลี่ยนเป็น IP address หรือโดเมนของเซิร์ฟเวอร์ของคุณ</span>
    <span class="token comment">// นี่คือ URL พื้นฐานสำหรับ API call ทั้งหมด</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-val">val</span> BASE_URL <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"http://your-server-ip:8080/lazyhr/"</span></span>

    <span class="token comment">// สร้าง logging interceptor เพื่อดูรายละเอียด request/response ใน Logcat</span>
    <span class="token comment">// ซึ่งช่วยในการดีบักปัญหาเน็ตเวิร์กได้มาก</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> loggingInterceptor <span class="token operator">=</span> <span class="token function">HttpLoggingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>
        level <span class="token operator">=</span> HttpLoggingInterceptor<span class="token punctuation">.</span>Level<span class="token punctuation">.</span>BODY <span class="token comment">// แสดง log ทั้งหมดของ request และ response body</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// สร้าง OkHttpClient และเพิ่ม logging interceptor</span>
    <span class="token comment">// OkHttp คือ HTTP client ที่อยู่เบื้องหลัง Retrofit</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> okHttpClient <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>loggingInterceptor<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// สร้าง Retrofit instance โดยใช้ 'lazy' delegate</span>
    <span class="token comment">// หมายความว่า instance จะถูกสร้างเมื่อถูกเรียกใช้ครั้งแรกเท่านั้น</span>
    <span class="token keyword keyword-val">val</span> instance<span class="token operator">:</span> Retrofit <span class="token keyword keyword-by">by</span> lazy <span class="token punctuation">{</span>
        Retrofit<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span>BASE_URL<span class="token punctuation">)</span> <span class="token comment">// กำหนด URL พื้นฐานสำหรับ request ทั้งหมด</span>
            <span class="token punctuation">.</span><span class="token function">client</span><span class="token punctuation">(</span>okHttpClient<span class="token punctuation">)</span> <span class="token comment">// ใช้ OkHttpClient ที่เราปรับแต่งเองพร้อมกับ logger</span>
            <span class="token punctuation">.</span><span class="token function">addConverterFactory</span><span class="token punctuation">(</span>GsonConverterFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ใช้ Gson ในการจัดการ JSON</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="3-กําหนด-api-interface">3. กำหนด API Interface </h2>
<p>สร้าง Interface เพื่อกำหนดว่าเราจะคุยกับ API endpoint ไหนได้บ้าง เหมือนกับการสร้างเมนูอาหาร Retrofit จะจัดการเรื่องการ "ปรุงอาหาร" หรือการเรียก API ให้เราเอง</p>
<p><strong>ทำไมต้องเป็น Interface?</strong></p>
<ul>
<li>มันเหมือนการสร้างเมนูอาหาร เราแค่บอกว่ามี "เมนู" (API call) อะไรบ้าง แต่ไม่ต้องไปยุ่งกับ "วิธีทำ" ในครัว Retrofit จะจัดการเรื่องยากๆ ให้เราเอง เป็นวิธีที่สะอาดและเป็นระเบียบมาก</li>
</ul>
<p><strong>ทำไมต้อง <code>suspend</code>?</strong></p>
<ul>
<li>คำสั้นๆ นี้มีความหมายมาก มันบอก Kotlin ว่าฟังก์ชันนี้อาจจะใช้เวลาสักพัก (เช่น การเรียก API) และอนุญาตให้ "หยุดรอ" แล้วค่อยกลับมาทำต่อได้ โดยไม่ทำให้แอปค้าง นี่คือหัวใจของการทำงานของ Coroutines</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Body
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>GET
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>POST
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Path
<span class="token keyword keyword-import">import</span> retrofit2<span class="token punctuation">.</span>http<span class="token punctuation">.</span>Query

<span class="token keyword keyword-interface">interface</span> ApiService <span class="token punctuation">{</span>

    <span class="token comment">// --- ส่วนจัดการผู้ใช้ ---</span>
    <span class="token comment">// @GET กำหนด HTTP GET request ส่วน string คือ path ที่ต่อจาก base URL</span>
    <span class="token comment">// @Path จะแทนที่ {userId} ใน URL ด้วยค่าของพารามิเตอร์ userId</span>
    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/users/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span>

    <span class="token comment">// --- ส่วนจัดการการลงเวลา ---</span>
    <span class="token comment">// @POST กำหนด HTTP POST request</span>
    <span class="token comment">// @Query จะเพิ่ม query parameter เข้าไปใน URL (เช่น /clock-in?userId=1)</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-in"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/clock-out"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span><span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/today/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getTodayAttendance</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Attendance<span class="token operator">?</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserAttendance</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"startTimestamp"</span></span><span class="token punctuation">)</span> startTimestamp<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"endTimestamp"</span></span><span class="token punctuation">)</span> endTimestamp<span class="token operator">:</span> Long
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/attendance/history/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token comment">// --- ส่วนจัดการการลา ---</span>
    <span class="token comment">// @Body บอกให้ Retrofit แปลง object leaveRequest เป็น JSON ใน request body</span>
    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/apply"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span><span class="token annotation builtin">@Body</span> leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>

    <span class="token annotation builtin">@GET</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/user/{userId}"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserLeaves</span><span class="token punctuation">(</span><span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"userId"</span></span><span class="token punctuation">)</span> userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span><span class="token operator">&gt;</span>

    <span class="token annotation builtin">@POST</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"api/leave/{leaveId}/approve"</span></span><span class="token punctuation">)</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">approveLeave</span><span class="token punctuation">(</span>
        <span class="token annotation builtin">@Path</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"leaveId"</span></span><span class="token punctuation">)</span> leaveId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"approverId"</span></span><span class="token punctuation">)</span> approverId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
        <span class="token annotation builtin">@Query</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"comments"</span></span><span class="token punctuation">)</span> comments<span class="token operator">:</span> String<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="4-สร้าง-data-classes-dtos">4. สร้าง Data Classes (DTOs) </h2>
<p>สร้าง <code>data class</code> ใน Kotlin เพื่อเป็นโมเดลสำหรับข้อมูลที่เราจะรับส่งกับเซิร์ฟเวอร์ ชื่อ property ในคลาสควรจะตรงกับชื่อ key ใน JSON</p>
<p><strong>ทำไมต้องเป็น <code>data class</code>?</strong></p>
<ul>
<li><code>data class</code> คือความสามารถพิเศษของ Kotlin เราแค่ประกาศว่าอยากเก็บข้อมูลอะไรบ้าง แล้ว Kotlin จะเขียนโค้ดน่าเบื่อๆ ให้เราเองหมดเลย (เช่น <code>toString()</code>, <code>equals()</code>) ทำให้โค้ดเราสั้นและสะอาดตา</li>
</ul>
<p><strong>ทำไมต้องตั้งชื่อให้ตรงกับ JSON?</strong></p>
<ul>
<li>เพื่อให้ Gson ทำงานได้ง่ายๆ ถ้าชื่อ property ใน data class ของเราตรงกับชื่อ key ใน JSON, Gson จะสามารถแปลงข้อมูลไปมาได้เองโดยอัตโนมัติ เหมือนมีเวทมนตร์เลย!</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// data class สำหรับเก็บข้อมูล User ชื่อ property จะตรงกับ key ใน JSON</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">User</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> firstName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> lastName<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> employeeId<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> department<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> position<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> hireDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token comment">// Unix timestamp หน่วยเป็นมิลลิวินาที</span>
    <span class="token keyword keyword-val">val</span> salary<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> role<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ADMIN", "MANAGER", "EMPLOYEE"</span>
    <span class="token keyword keyword-val">val</span> isActive<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// ... ฟิลด์อื่นๆ</span>
<span class="token punctuation">)</span>

<span class="token comment">// data class สำหรับ Attendance</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">Attendance</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> attendanceDate<span class="token operator">:</span> Long<span class="token punctuation">,</span> <span class="token comment">// Timestamp ของเวลาเริ่มต้นของวัน</span>
    <span class="token keyword keyword-val">val</span> clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>   <span class="token comment">// Timestamp ของเวลาที่ลงชื่อเข้างาน</span>
    <span class="token keyword keyword-val">val</span> clockOutTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>  <span class="token comment">// Timestamp ของเวลาที่ลงชื่อออกงาน</span>
    <span class="token keyword keyword-val">val</span> totalHours<span class="token operator">:</span> Double<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> overtimeHours<span class="token operator">:</span> Double<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PRESENT", "ABSENT", "LATE", "HALF_DAY"</span>
    <span class="token keyword keyword-val">val</span> notes<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> breakDurationMinutes<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// ... ฟิลด์อื่นๆ</span>
<span class="token punctuation">)</span>

<span class="token comment">// Data Transfer Object (DTO) สำหรับสร้างคำขอลา</span>
<span class="token comment">// เป็น best practice ที่จะใช้ DTO สำหรับ request body เพื่อควบคุมข้อมูลที่จะส่ง</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "ANNUAL", "PRIVATE", "SICK", "SPECIAL_HOLIDAY"</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>   <span class="token comment">// "AM", "PM", "FULL_DAY"</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>       <span class="token comment">// Unix timestamp หน่วยเป็นมิลลิวินาที</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>         <span class="token comment">// Unix timestamp หน่วยเป็นมิลลิวินาที</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String
<span class="token punctuation">)</span>

<span class="token comment">// data class สำหรับ response ของคำขอลา</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> <span class="token function">LeaveRequest</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> userId<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leaveCategory<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> leavePeriod<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> startDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> endDate<span class="token operator">:</span> Long<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> reason<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "PENDING", "APPROVED", "REJECTED"</span>
    <span class="token keyword keyword-val">val</span> appliedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> approvedDate<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> comments<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> totalDays<span class="token operator">:</span> Double<span class="token operator">?</span>
    <span class="token comment">// ... ฟิลด์อื่นๆ</span>
<span class="token punctuation">)</span>

<span class="token comment">// โครงสร้าง API Response มาตรฐาน</span>
<span class="token comment">// 'data' property เป็น generic ทำให้สามารถเก็บข้อมูลประเภทใดก็ได้ (User, List&lt;Attendance&gt;, etc.)</span>
<span class="token keyword keyword-data">data</span> <span class="token keyword keyword-class">class</span> ApiResponse<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-val">val</span> status<span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// "success" หรือ "error"</span>
    <span class="token keyword keyword-val">val</span> message<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span><span class="token operator">:</span> T<span class="token operator">?</span>
<span class="token punctuation">)</span>
</code></pre><h2 id="5-การเรียกใช้งาน-api-รูปแบบ-mvc">5. การเรียกใช้งาน API (รูปแบบ MVC) </h2>
<p>เราจะใช้สถาปัตยกรรมแบบ MVC (Model-View-Controller) ในการเรียก API ซึ่งจะช่วยแยกโค้ดออกเป็นส่วนๆ ทำให้จัดการง่าย ทดสอบง่าย และดูแลรักษาง่ายในระยะยาว</p>
<h3 id="ชั้น-model-data-repository">ชั้น Model (Data Repository) </h3>
<p>Repository คือ "แหล่งข้อมูลกลาง" ของแอปเรา มีหน้าที่ไปหาข้อมูลมาให้ ไม่ว่าข้อมูลนั้นจะมาจากเน็ตเวิร์กหรือจากฐานข้อมูลในเครื่องก็ตาม</p>
<p><strong>ทำไมต้อง <code>withContext(Dispatchers.IO)</code>?</strong></p>
<ul>
<li>นี่คือส่วนสำคัญของ Coroutines ที่บอกว่า "โค้ดส่วนนี้เป็นการคุยกับเน็ตเวิร์กนะ ช่วยย้ายไปทำงานบน background thread ที่เหมาะกับงานแบบนี้ให้หน่อย" เพื่อไม่ให้หน้าจอแอปของเราค้าง</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// คลาส Repository รับผิดชอบการดำเนินการเกี่ยวกับข้อมูลทั้งหมด</span>
<span class="token keyword keyword-class">class</span> HrRepository <span class="token punctuation">{</span>
    
    <span class="token comment">// สร้าง instance ของ ApiService</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> apiService <span class="token operator">=</span> ApiClient<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApiService<span class="token operator">::</span><span class="token keyword keyword-class">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    
    <span class="token comment">// แต่ละฟังก์ชันใน repository จะเรียกฟังก์ชันที่สอดคล้องกันใน ApiService</span>
    <span class="token comment">// เราใช้ withContext(Dispatchers.IO) เพื่อให้แน่ใจว่า network call เกิดขึ้นบน background thread</span>
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">clockOut</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequestDto<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>LeaveRequest<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveRequest<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-suspend">suspend</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Attendance<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            apiService<span class="token punctuation">.</span><span class="token function">getAttendanceHistory</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="ชั้น-controller">ชั้น Controller </h3>
<p>Controller คือ "สมอง" ของการทำงาน มันจะรับคำสั่งจากผู้ใช้ (เช่น การกดปุ่ม), ไปขอข้อมูลจาก Repository, แล้วก็สั่งให้ View (หน้าจอ) แสดงผลลัพธ์</p>
<p><strong>ทำไมต้อง <code>CoroutineScope(Dispatchers.Main)</code>?</strong></p>
<ul>
<li>เรากำลังสร้าง "ขอบเขต" การทำงานของ Coroutine ที่ผูกกับ Main Thread ซึ่งเป็น thread เดียวที่สามารถอัปเดตหน้าจอ UI ได้</li>
</ul>
<p><strong>ทำไมต้อง <code>try-catch-finally</code>?</strong></p>
<ul>
<li>นี่คือตาข่ายนิรภัยของเรา! บล็อก <code>try</code> คือที่ที่เราทำสิ่งที่เสี่ยง (เช่น เรียก API), <code>catch</code> คือที่ที่เราจัดการเมื่อเกิดข้อผิดพลาด, และ <code>finally</code> คือโค้ดที่จะทำงาน <em>เสมอ</em> ไม่ว่าจะสำเร็จหรือล้มเหลว เหมาะสำหรับซ่อน loading spinner</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>CoroutineScope
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch
<span class="token keyword keyword-import">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>withContext

<span class="token comment">// Controller จะรับ reference ของ View interface</span>
<span class="token keyword keyword-class">class</span> <span class="token function">HrController</span><span class="token punctuation">(</span><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> view<span class="token operator">:</span> HrView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> repository <span class="token operator">=</span> <span class="token function">HrRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// สร้าง coroutine scope สำหรับการ launch coroutine จาก controller</span>
    <span class="token comment">// เราใช้ Dispatchers.Main เพราะ controller จะต้องอัปเดต UI</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-val">val</span> controllerScope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">clockInUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Launch coroutine ใหม่โดยไม่บล็อก thread ปัจจุบัน</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// แสดง loading indicator บน UI</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// ดึงข้อมูลจาก repository (ซึ่งจะทำงานบน background thread)</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">clockIn</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token comment">// สลับกลับมาที่ main thread เพื่ออัปเดต UI</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-val">val</span> <span class="token keyword keyword-data">data</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span>
                        <span class="token keyword keyword-val">val</span> clockInTime <span class="token operator">=</span> <span class="token keyword keyword-data">data</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"clockInTime"</span></span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span><span class="token operator">?</span> Long
                        view<span class="token punctuation">.</span><span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token punctuation">)</span> <span class="token comment">// อัปเดต UI ด้วยผลลัพธ์</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"การลงเวลาเข้างานล้มเหลว: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// แสดงข้อความผิดพลาด</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// จัดการกับ exception เช่น network error</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"ข้อผิดพลาดเครือข่าย: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// บล็อกนี้จะทำงานเสมอ ไม่ว่าจะเกิด error หรือไม่</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">applyForLeave</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> reason<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// ตัวอย่างการสร้าง request object</span>
                <span class="token keyword keyword-val">val</span> startTimestamp <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-val">val</span> endTimestamp <span class="token operator">=</span> startTimestamp <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// 2 วันถัดไป</span>
                
                <span class="token keyword keyword-val">val</span> leaveDto <span class="token operator">=</span> <span class="token function">LeaveRequestDto</span><span class="token punctuation">(</span>
                    userId <span class="token operator">=</span> userId<span class="token punctuation">,</span>
                    leaveCategory <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"ANNUAL"</span></span><span class="token punctuation">,</span>
                    leavePeriod <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"FULL_DAY"</span></span><span class="token punctuation">,</span>
                    startDate <span class="token operator">=</span> startTimestamp<span class="token punctuation">,</span>
                    endDate <span class="token operator">=</span> endTimestamp<span class="token punctuation">,</span>
                    reason <span class="token operator">=</span> reason
                <span class="token punctuation">)</span>
                
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span>leaveDto<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"การยื่นใบลาล้มเหลว: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"ข้อผิดพลาดเครือข่าย: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-fun">fun</span> <span class="token function">loadUserData</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        controllerScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-val">val</span> response <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string-literal singleline"><span class="token string">"success"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">displayUserData</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                        view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"โหลดข้อมูลผู้ใช้ล้มเหลว: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">response<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"ข้อผิดพลาดเครือข่าย: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="view-interface-2">View Interface </h3>
<p>Interface นี้เปรียบเสมือน "สัญญาใจ" ที่บอกว่า "หน้าจอไหนก็ตามที่อยากจะเป็น <code>HrView</code> จะต้องทำสิ่งเหล่านี้ได้นะ (เช่น แสดง loading, แสดง error)" ซึ่งช่วยให้โค้ดเราสะอาดและทดสอบ Controller ได้ง่ายโดยไม่ต้องมีหน้าจอจริงๆ</p>
<p><strong>ทำไมต้องเป็น Interface?</strong></p>
<ul>
<li>เป็นหลักการพื้นฐานของการออกแบบซอฟต์แวร์ที่ดี มันช่วยแยก "สิ่งที่ต้องทำ" (สัญญา) ออกจาก "วิธีทำ" (implementation) ทำให้โค้ดของเรายืดหยุ่นและแก้ไขได้ง่ายในอนาคต</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token comment">// interface นี้กำหนด contract ระหว่าง Controller และ View</span>
<span class="token comment">// Activity หรือ Fragment จะ implement interface นี้</span>
<span class="token keyword keyword-interface">interface</span> HrView <span class="token punctuation">{</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">showLoading</span><span class="token punctuation">(</span>isLoading<span class="token operator">:</span> Boolean<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequest<span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-fun">fun</span> <span class="token function">displayUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="การใช้งานใน-activityfragment-ชั้น-view">การใช้งานใน Activity/Fragment (ชั้น View) </h3>
<p>นี่คือหน้าจอ UI ของเราจริงๆ หน้าที่หลักของมันคือแสดงผลให้สวยงามและแจ้ง Controller เมื่อผู้ใช้ทำอะไรบางอย่าง มันจะ implement <code>HrView</code> interface เพื่อรักษาสัญญาที่เราได้ให้ไว้</p>
<p><strong>ทำไมต้องมอบหมายให้ Controller?</strong></p>
<ul>
<li>เพื่อให้โค้ดใน Activity/Fragment ของเราเรียบง่ายและโฟกัสไปที่เรื่อง UI เท่านั้น ส่วน logic ที่ซับซ้อนจะไปอยู่ใน Controller ทำให้โค้ดทั้งหมดอ่านง่าย, ดีบักง่าย, และทดสอบง่ายขึ้นเยอะ</li>
</ul>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword keyword-import">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Button
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ProgressBar
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Toast
<span class="token keyword keyword-import">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View

<span class="token comment">// MainActivity จะ implement HrView interface</span>
<span class="token keyword keyword-class">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HrView <span class="token punctuation">{</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> controller<span class="token operator">:</span> HrController
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> loadingIndicator<span class="token operator">:</span> ProgressBar
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> clockInButton<span class="token operator">:</span> Button
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> applyLeaveButton<span class="token operator">:</span> Button
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-lateinit">lateinit</span> <span class="token keyword keyword-var">var</span> userInfoText<span class="token operator">:</span> TextView
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>
        
        <span class="token comment">// สร้าง controller โดยส่ง reference ของ activity นี้ (view) ไปด้วย</span>
        controller <span class="token operator">=</span> <span class="token function">HrController</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span>
        <span class="token function">initViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">setupClickListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">initViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        loadingIndicator <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>loading_indicator<span class="token punctuation">)</span>
        clockInButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_clock_in<span class="token punctuation">)</span>
        applyLeaveButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_apply_leave<span class="token punctuation">)</span>
        userInfoText <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_user_info<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">setupClickListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// เมื่อปุ่มถูกคลิก ให้เรียกเมธอดที่สอดคล้องกันใน controller</span>
        clockInButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            controller<span class="token punctuation">.</span><span class="token function">clockInUser</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span> <span class="token comment">// เปลี่ยนเป็น user ID จริง</span>
        <span class="token punctuation">}</span>
        
        applyLeaveButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            controller<span class="token punctuation">.</span><span class="token function">applyForLeave</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"พักร้อนประจำปี"</span></span><span class="token punctuation">)</span> <span class="token comment">// เปลี่ยนเป็น user ID และเหตุผลจริง</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// โหลดข้อมูลเริ่มต้นเมื่อ activity เริ่มทำงาน</span>
        controller<span class="token punctuation">.</span><span class="token function">loadUserData</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// --- การ implement HrView interface ---</span>
    <span class="token comment">// เมธอดเหล่านี้จะถูกเรียกโดย controller เพื่ออัปเดต UI</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">showLoading</span><span class="token punctuation">(</span>isLoading<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        loadingIndicator<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> View<span class="token punctuation">.</span>VISIBLE <span class="token keyword keyword-else">else</span> View<span class="token punctuation">.</span>GONE
        clockInButton<span class="token punctuation">.</span>isEnabled <span class="token operator">=</span> <span class="token operator">!</span>isLoading
        applyLeaveButton<span class="token punctuation">.</span>isEnabled <span class="token operator">=</span> <span class="token operator">!</span>isLoading
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onError</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onClockInSuccess</span><span class="token punctuation">(</span>clockInTime<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"ลงเวลาเข้างานสำเร็จเวลา: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">clockInTime</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">onLeaveApplicationSuccess</span><span class="token punctuation">(</span>leaveRequest<span class="token operator">:</span> LeaveRequest<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"ยื่นใบลาสำเร็จ รหัสคำขอ: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">leaveRequest<span class="token operator">?</span><span class="token punctuation">.</span>id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-override">override</span> <span class="token keyword keyword-fun">fun</span> <span class="token function">displayUserData</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        user<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
            userInfoText<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"ยินดีต้อนรับ, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>firstName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>lastName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\nแผนก: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">it<span class="token punctuation">.</span>department</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>